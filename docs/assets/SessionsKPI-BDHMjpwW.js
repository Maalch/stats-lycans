import{r as o,j as s}from"./index-f3Lv4EF0.js";import{aP as p,aR as y,aS as v,_ as f,aQ as g}from"./PieChart-BoCpi-eW.js";function N(){const[t,x]=o.useState([]),[u,r]=o.useState(!0),[c,d]=o.useState(null);return o.useEffect(()=>{(async()=>{try{r(!0);const n=await fetch("https://script.google.com/macros/s/AKfycbzqIFCxtyZFLnen3Hv3LVSfhIUIlRR921hVeMwxtKvkBzHkNBZmIleTsAkCqcsKmYR-/exec?action=sessionStats");if(!n.ok)throw new Error(`Erreur HTTP: ${n.status}`);const e=await n.json();x(e)}catch(a){d(a instanceof Error?a:new Error(String(a))),console.error("Erreur lors de la récupération des stats de session:",a)}finally{r(!1)}})()},[]),{gameSessionData:t,isDataFetching:u,fetchError:c}}function b(t){const[x,u]=o.useState(null),[r,c]=o.useState(!1),[d,h]=o.useState(null);return o.useEffect(()=>{if(!t){u(null),c(!1),h(null);return}c(!0),h(null),fetch(`https://script.google.com/macros/s/AKfycbzqIFCxtyZFLnen3Hv3LVSfhIUIlRR921hVeMwxtKvkBzHkNBZmIleTsAkCqcsKmYR-/exec?action=playerStatsBySession&sessionDate=${encodeURIComponent(t)}`).then(async n=>{if(!n.ok)throw new Error(`Erreur HTTP: ${n.status}`);const e=await n.json();u(e)}).catch(n=>h(n instanceof Error?n:new Error(String(n)))).finally(()=>c(!1))},[t]),{playerStatsBySession:x,loading:r,error:d}}const j=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"];function E(){const{gameSessionData:t,isDataFetching:x,fetchError:u}=N(),[r,c]=o.useState(null),{playerStatsBySession:d,loading:h,error:a}=b(r);if(x)return s.jsx("div",{children:"Chargement des statistiques des sessions..."});if(u)return s.jsxs("div",{children:["Erreur: ",u.message]});if(!t||t.length===0)return s.jsx("div",{children:"Aucune donnée de session disponible"});const n=r?t.find(e=>e.DateSession===r):null;return s.jsxs("div",{className:"lycans-session-stats",children:[s.jsx("h2",{children:"Statistiques par Session de Jeu"}),s.jsxs("div",{className:"lycans-session-selector",children:[s.jsx("label",{children:"Sélectionner une session: "}),s.jsxs("select",{value:r||"",onChange:e=>c(e.target.value||null),className:"lycans-selector",children:[s.jsx("option",{value:"",children:"Toutes les sessions"}),t.map(e=>s.jsxs("option",{value:e.DateSession,children:[e.DateSession," (",e.NombreParties," parties)"]},e.DateSession))]})]}),!r&&s.jsxs("div",{className:"lycans-sessions-table",children:[s.jsx("h3",{children:"Vue d'ensemble des sessions"}),s.jsx("div",{className:"table-container",children:s.jsxs("table",{className:"lycans-stats-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Date"}),s.jsx("th",{children:"Parties"}),s.jsx("th",{children:"Durée moyenne"}),s.jsx("th",{children:"Temps total"}),s.jsx("th",{children:"Joueurs/partie"}),s.jsx("th",{children:"Versions"}),s.jsx("th",{children:"Lien Youtube"})]})}),s.jsx("tbody",{children:t.map(e=>s.jsxs("tr",{onClick:()=>c(e.DateSession),className:"clickable-row",children:[s.jsx("td",{children:e.DateSession}),s.jsx("td",{children:e.NombreParties}),s.jsx("td",{children:e.DureeMoyenne}),s.jsx("td",{children:e.TempsJeuTotal}),s.jsx("td",{children:e.JoueursMoyen}),s.jsx("td",{children:e.Versions&&e.Versions.length>0?e.Versions.join(", "):s.jsx("span",{children:"-"})}),s.jsx("td",{children:e.VideosYoutube&&e.VideosYoutube.length>0?e.VideosYoutube.map((i,l)=>s.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",onClick:m=>m.stopPropagation(),className:"video-link",children:l+1},l)):s.jsx("span",{children:"-"})})]},e.DateSession))})]})})]}),n&&s.jsxs("div",{className:"lycans-session-detail",children:[s.jsxs("h3",{children:["Session du ",n.DateSession]}),s.jsxs("div",{className:"lycans-stats-summary",children:[s.jsxs("div",{className:"lycans-stat-box",children:[s.jsx("h4",{children:"Nombre de Parties"}),s.jsx("p",{children:n.NombreParties})]}),s.jsxs("div",{className:"lycans-stat-box",children:[s.jsx("h4",{children:"Durée Moyenne"}),s.jsx("p",{children:n.DureeMoyenne})]}),s.jsxs("div",{className:"lycans-stat-box",children:[s.jsx("h4",{children:"Temps de Jeu Total"}),s.jsx("p",{children:n.TempsJeuTotal})]}),s.jsxs("div",{className:"lycans-stat-box",children:[s.jsx("h4",{children:"Nombre Moyen de Joueurs"}),s.jsx("p",{children:n.JoueursMoyen})]})]}),n.VideosYoutube&&n.VideosYoutube.length>0&&s.jsxs("div",{className:"lycans-video-links",children:[s.jsx("h4",{children:"Liens Youtube de la session"}),s.jsx("div",{className:"lycans-video-grid",children:n.VideosYoutube.map((e,i)=>s.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"lycans-video-button",children:["Lien ",i+1]},i))})]}),s.jsxs("div",{className:"lycans-session-player-stats",children:[s.jsx("h3",{children:"Statistiques des joueurs pour cette session"}),h&&s.jsx("div",{children:"Chargement des statistiques des joueurs..."}),a&&s.jsx("div",{className:"info-message error",children:s.jsxs("p",{children:["Erreur: ",a.message]})}),!h&&!a&&d?.length===0&&s.jsx("div",{className:"info-message",children:s.jsx("p",{children:"Aucune donnée de joueur disponible pour cette session."})}),!h&&!a&&d&&d.length>0&&s.jsx("div",{className:"player-session-cards",children:d.map(e=>s.jsxs("div",{className:"player-session-card",children:[s.jsx("h4",{children:e.JoueurID}),s.jsxs("div",{className:"player-session-stats",children:[s.jsxs("div",{className:"player-stat",children:[s.jsx("span",{children:"Parties:"}),s.jsx("strong",{children:e.PartiesSession})]}),s.jsxs("div",{className:"player-stat",children:[s.jsx("span",{children:"Victoires:"}),s.jsxs("strong",{children:[e.VictoiresSession," (",(e.TauxVictoireSession*100).toFixed(1),"%)"]})]}),s.jsxs("div",{className:"player-stat",children:[s.jsx("span",{children:"Survie:"}),s.jsxs("strong",{children:[e.SurvivantSession," (",(e.TauxSurvieSession*100).toFixed(1),"%)"]})]})]}),e.DistributionRolesSession.length>0&&s.jsxs("div",{className:"player-roles-chart",children:[s.jsx("h5",{children:"Rôles joués"}),s.jsx(p,{width:"100%",height:100,children:s.jsxs(y,{children:[s.jsx(v,{data:e.DistributionRolesSession.slice(0,5),cx:"50%",cy:"50%",innerRadius:15,outerRadius:30,dataKey:"Count",nameKey:"RoleName",children:e.DistributionRolesSession.slice(0,5).map((i,l)=>s.jsx(f,{fill:j[l%j.length]},`cell-${l}`))}),s.jsx(g,{formatter:(i,l,m)=>{const S=m?.payload?.RoleName||"";return[`${i} fois`,`${S}`]}})]})}),s.jsx("div",{className:"role-legend",children:e.DistributionRolesSession.slice(0,8).map((i,l)=>s.jsxs("div",{className:"role-item",children:[s.jsx("span",{className:"role-color",style:{backgroundColor:j[l%j.length]}}),s.jsx("span",{className:"role-name",children:i.RoleName})]},l))})]})]},e.JoueurID))})]})]})]})}export{E as default};
